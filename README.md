# 多模态无人机传感与边缘计算融合的智慧停车系统

本项目由湖南科技大学23级物联网LTQY团队开发，旨在构建一个集无人机巡检、高精度3D建模、AI时序预测与边缘智能计算于一体的次世代智慧停车解决方案。系统通过深度融合多模态感知技术与先进算法，为用户和管理者提供前所未有的智能化、可视化、精细化停车服务。

## 核心技术创新

### 1. 无人机载荷与多模态感知系统

为实现高效、精准的数据采集，我们自主设计并组装了专用无人机载荷，其核心为 **AtomS3R-M12** 物联网可编程控制器。

*   **主控与视觉**: 采用 ESP32-S3 主控，集成 **OV3660 120°广角摄像头**，支持高达30fps的图像采集，为停车场实时监控与AI识别提供高质量视觉数据源。
*   **九轴姿态感知**: 集成 **BMM150地磁传感器** 与 **BMI270六轴姿态传感器**，构成九轴惯性测量单元（IMU）。该系统能以0.05%的加速度精度、0.05°/s的角速度精度和0.3μT的地磁精度，精准感知无人机的飞行姿态与运动轨迹，为后续数据融合与三维重建提供精确的空间基准。

### 2. STID时序预测模型应用

我们转化并应用了论文 **《Spatial-Temporal Identity: A Simple yet Effective Baseline for Multivariate Time Series Forecasting》** 的研究成果，开发了停车场车位需求预测模型。

*   **问题定义**: 将城市内的多个停车场视为一个多元时间序列（MTS）系统，预测未来各停车场占用率。
*   **核心思想**: 通过为简单的MLP网络附加“时空身份”信息，高效解决样本的“不可区分性”问题。
    *   **空间身份 (Spatial Identity)**: 为每个停车场分配唯一的嵌入向量，使模型能区分不同地理位置和功能属性（如商业区、住宅区）的停车场，即使它们的短期历史数据相似。
    *   **时间身份 (Temporal Identity)**: 引入“日内时间”和“周内日期”两种身份向量，使模型能精准捕捉工作日与周末、高峰与平峰时段的周期性模式差异。
*   **性能表现**: 在数据集上，模型性能卓越且稳定，关键指标趋近于：**MAE ≈ 0.14**, **RMSE ≈ 0.5**, **MAPE ≈ 0.05**。我们还制作了Manim动画以直观展示模型的收敛过程。

### 3. LiDAR辅助的大规模车库3D建模与路径规划

我们借鉴了 **SIGGRAPH Asia 2024** 的研究成果 **《LetsGo: Large-Scale Garage Modeling and Rendering via LiDAR-Assisted Gaussian Primitives》**，并在此基础上进行了创新性拓展。

*   **数据采集**: 使用自研的 **手持式扫描仪 Polar**（集成IMU、LiDAR、鱼眼相机），对大型地下车库进行快速、精确的扫描，有效克服了传统SfM方法在弱纹理、重复结构场景下的难题。
*   **三维重建与渲染**: 利用采集到的点云数据，结合3D高斯溅射（3D Gaussian Splatting）算法，生成高保真的停车场数字孪生模型。并基于 **LOD-Web-Viewer** 实现了可在轻量化设备上流畅渲染的多分辨率模型。
*   **交互式路径规划**:
    1.  **语义标注与降维**: 对3D模型中的道路、车位、出入口等关键位置进行语义标注，并提取其视图矩阵。
    2.  **拓扑图构建**: 将三维空间关系抽象为轻量化的 **二维逻辑拓扑图**，其中节点代表语义位置，带权重的边代表节点间的真实物理距离。
    3.  **高效寻路**: 在此拓扑图上，运用 **A\*寻路算法**，实现从用户当前位置到目标车位的毫秒级最优路径规划。

### 4. 基于NVIDIA Jetson的边缘智能计算

在 **NVIDIA Jetson Orin Nano** 边缘计算平台上，我们部署了一套高效的AI处理流程。

*   **车位状态识别**:
    1.  **初步检测**: 使用在公开数据集上预训练的 **YOLOv11l** 模型，对无人机回传的图像进行车辆检测。
    2.  **异常值过滤**: 通过统计学方法（IQR）自动过滤尺寸异常的检测框，生成高可信度的初始车位坐标。
    3.  **人工矫正**: 提供交互式编辑器，允许管理员对自动标注结果进行快速微调。
    4.  **状态判断**: 采用 **五点关键点法**，通过判断车辆边界框的五个关键点是否落入停车位多边形内，精准判断车位占用状态。

*   **高性能车牌识别**:
    1.  **并行架构**: 基于 `concurrent.futures.ProcessPoolExecutor` 实现多进程并行计算，大幅提升处理吞吐量。
    2.  **智能追踪与决策**: 引入跳帧处理、IOU关联追踪机制，并为每个目标维护多个识别候选结果。通过设定最低确认次数和追踪器生命周期，系统可在时间滑动窗口内对车牌进行最终决策，有效应对遮挡、角度变化等复杂情况。

## 系统架构与技术栈

*   **前端**: React, TypeScript, Vite
*   **后端**: Go (Gin), PostgreSQL, Kafka
*   **UI/UX**: 遵循 Apple iOS Design Language 设计语言，打造前沿、科技感的界面。
*   **3D渲染**: Three.js, WebGL
*   **AI框架与平台**: PyTorch, Coze, 火山引擎

---

## 核心功能实现 (竞赛评审重点)

### 1. 火山引擎RTC（实时音视频通信）整合

*   **无人机超低延迟视频回传**: 无人机采集的高清视频流，通过火山引擎RTC实时推送到监控中心，端到端延迟 **低于100ms**，确保了远程控制的即时性和准确性。
*   **沉浸式视频客服**: 用户可在App内通过“视频客服”功能，一键与人工坐席建立视频通话。客服后台可实时获取用户的精确位置、车辆信息和现场视频，提供“亲临现场”般的精准服务。

### 2. 扣子平台 (Coze) 深度应用

我们基于Coze平台及其内嵌的字节跳动豆包大模型，构建了服务于用户和管理员的双端AI机器人。

*   **用户端AI助理**:
    *   **核心定位**: 用户界面的核心交互中枢，提供一站式自然语言停车服务。
    *   **实现方式**:
        *   **智能对话**: 精准理解“找个最近的出口”、“我的车停在哪了？”等口语化指令。
        *   **知识库**: 集成停车场静态信息与STID模型预测的动态车位数据，提供即时问答。
        *   **工作流编排**: 将“反向寻车”等复杂请求编排为自动化工作流，调用后端A\*算法，为用户返回最优的2D或3D导航路径。
        *   **个性化推荐**: 结合高德地图API与用户偏好，主动推荐停车场。

*   **管理端数据分析师**:
    *   **核心定位**: 管理后台的AI数据分析引擎。
    *   **实现方式**:
        *   **自动化报告**: 管理员可通过“生成上周运营报告”等自然语言指令，驱动机器人从Pgsql数据库提取数据，自动生成结构化分析报告。
        *   **主动洞察与预警**: 机器人持续监控Kafka中的实时数据流，结合STID预测结果，主动发现潜在拥堵风险，并通过“实时播报”模块发出预警。

### 3. 火山引擎边缘智能平台应用

*   **边缘应用统一部署**: 将在Jetson Orin Nano上运行的YOLOv11l、HyperLPR3等多进程引擎、状态判断算法等，打包成标准容器镜像，通过平台控制台一键下发至所有边缘节点。
*   **数据流水线编排**: 在平台可视化界面中，定义了从视频流输入，到车辆检测、车牌识别，再到结构化数据输出的完整数据处理流水线。
*   **云边协同数据策略**:
    *   **高优数据实时上云**: 车位状态变更、车牌号等关键结果，实时上报至云端Kafka，驱动应用更新。
    *   **低优数据批量上云**: 用于模型训练的原始图像等数据，在边缘节点缓存，于夜间等网络空闲时段批量上传，极大节省了日间带宽。

### 4. 火山引擎物联网平台应用

我们使用火山引擎物联网平台（公共实例）对无人机及其传感器进行全生命周期管理。

*   **设备身份与安全**: 为每架无人机创建唯一设备身份，使用设备密钥进行安全认证接入。
*   **设备影子**: 维护无人机设备影子，即使设备短暂离线，云端应用仍可获取其最后状态，保证业务连续性。
*   **固件远程升级 (OTA)**: 无需召回设备，即可通过平台对无人机主控固件或边缘AI应用进行批量、静默的远程升级。
*   **规则引擎**: 配置规则引擎对传感器原始数据进行预处理和分发，如将姿态数据转发至告警系统，业务数据转发至Kafka。

### 5. 火山引擎边缘大模型网关应用

*   **语义缓存降低成本**: 利用网关内置的语义缓存机制，对于“收费标准”、“出口位置”等高频重复问题，直接从边缘缓存返回答案，显著降低大模型API调用成本和响应延迟。
*   **故障智能转移保障可用性**: 在网关中配置主备模型（主：豆包大模型，备：其他供应商模型），当主模型出现故障时，网关可自动、无缝地将请求切换至备用模型，保障AI服务的持续高可用。

---

## 系统界面

### 管理员界面

1.  **运营监控首页 (Dashboard)**: 实时呈现车流信息、道路拥堵指数、车位饱和度、环境监测数据和预警信息。
2.  **设备与资源管理**: 监控所有物联网设备健康状态，管理维护工单，进行资产与成本分析。
3.  **综合管理与分析**: 提供空间资源可视化、收费系统管理、运营活动分析等深度管理功能。
4.  **停车数据深度统计**: 对停车行为进行多维度分析，追踪停车指数、周转率等关键指标。

### 用户界面

1.  **AI交互界面**: 地图与AI聊天窗口融合，支持语音和文本输入，提供智能问答与服务。
2.  **停车信息中心**: 一站式展示当前停车位置、时长、费用、历史记录，并提供一键反向寻车功能。
3.  **我的车辆管理**: 管理用户车辆信息，查看车辆关联的停车数据。

## 安装与运行

**环境要求**

*   Node.js >= 16.0.0
*   pnpm (或 npm/yarn)

**前端项目**

1.  **安装依赖**
    ```bash
    pnpm install
    ```

2.  **配置环境变量**
    在项目根目录下创建 `.env.local` 文件，并填入必要的API密钥和后端服务地址：
    ```env
    # 示例
    VITE_AMAP_KEY=your_amap_api_key
    VITE_API_BASE_URL=http://your_backend_server_address
    # ... 其他必要的密钥
    ```

3.  **运行开发服务器**
    ```bash
    pnpm run dev
    ```

4.  **构建生产版本**
    ```bash
    pnpm run build
    ```

**后端项目**

请参考 `parking-backend-release` 仓库的说明文档进行部署。

## 致谢

本项目的开发过程中，我们借鉴和使用了以下优秀的研究成果和开源项目，在此表示衷心的感谢：

*   **时序预测模型**:
    > SHAO Z Z, ZHANG Z, WANG F, et al. Spatial-Temporal Identity: A Simple yet Effective Baseline for Multivariate Time Series Forecasting[C]//Proceedings of the 31st ACM International Conference on Information and Knowledge Management. New York: ACM, 2022: 4454-4458.

*   **车牌识别框架**:
    > GUO S. HyperLPR: an end-to-end license plate recognition framework[CP/OL]. [2024-05-24]. https://github.com/szad670401/HyperLPR.

*   **大规模车库建模与渲染**:
    > CUI J, CAO J, ZHAO F, et al. LetsGo: Large-Scale Garage Modeling and Rendering via LiDAR-Assisted Gaussian Primitives[C]//SIGGRAPH Asia 2024 Conference Papers. New York: ACM, 2024: 25. DOI: 10.1145/3687762.

*   **3D高斯溅射Web查看器**:
    > ZHAO F. LOD-Web-Viewer: a web viewer for 3D Gaussian Splatting with multi-level-of-detail[CP/OL]. [2024-05-24]. https://github.com/zhaofuq/LOD-Web-Viewer.

## 📄 开源协议

本项目遵循 [MIT License](LICENSE) 开源协议。

---

**开发团队**: 湖南科技大学 23级物联网 LTQY团队
